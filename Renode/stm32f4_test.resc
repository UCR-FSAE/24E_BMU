:name: STM32F4_Test

using sysbus

$name_tx?="stm32f4_tx"
$name_rx?="stm32f4_rx"

$bin_tx?=@https://github.com/UCR-FSAE/24E_BMU/raw/aryab/F4_BMU_dev/Renode/F4_TX.elf
$bin_rx?=@https://github.com/UCR-FSAE/24E_BMU/raw/aryab/F4_BMU_dev/Renode/F4_RX.elf

emulation CreateUARTHub "uarthub"

mach create $name_tx
machine LoadPlatformDescription @platforms/cpus/stm32f4.repl

connector Connect usart1 uarthub
showAnalyzer usart1

mach create $name_rx
machine LoadPlatformDescription @platforms/cpus/stm32f4.repl

connector Connect usart1 uarthub
showAnalyzer usart2

macro reset
"""
    mach set 0
    sysbus LoadELF $bin_tx

    mach set 1
    sysbus LoadELF $bin_rx
"""

runMacro $reset